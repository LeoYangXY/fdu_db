<!DOCTYPE html>
<html>
<head>
    <title>请假次数检查</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .search-box {
            background-color: #f5f5f5;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 30px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .danger {
            color: red;
            font-weight: bold;
        }
        .warning {
            color: orange;
        }
        .safe {
            color: green;
        }
        .error {
            color: red;
            padding: 10px;
            background-color: #ffeeee;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>请假次数检查</h1>

    <div class="search-box">
        <form method="post">
            {% csrf_token %}
            <label for="student_id">输入学号：</label>
            <input type="text" id="student_id" name="student_id" required>
            <button type="submit">查询</button>
        </form>
    </div>

    {% if searched %}
        {% if error %}
            <div class="error">{{ error }}</div>
        {% else %}
            <h2>{{ student.name }} ({{ student.student_id }}) 的请假统计</h2>

            {% if leave_stats %}
                <table>
                    <thead>
                        <tr>
                            <th>课程代码</th>
                            <th>课程名称</th>
                            <th>请假次数</th>
                            <th>状态</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for stat in leave_stats %}
                        <tr>
                            <td>{{ stat.course__course_code }}</td>
                            <td>{{ stat.course__course_name }}</td>
                            <td>{{ stat.total_leaves }}</td>
                            <td class="{% if stat.is_dangerous %}danger{% else %}safe{% endif %}">
                                {% if stat.is_dangerous %}
                                    危险！您已请假{{ stat.total_leaves }}次
                                {% else %}
                                    安全
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p>没有找到任何已批准的请假记录。</p>
            {% endif %}
        {% endif %}
    {% else %}
        <p>请输入学号查询您的请假情况。</p>
    {% endif %}
</body>
</html>