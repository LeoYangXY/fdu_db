<!DOCTYPE html>
<html>
<head>
    <title>{{ course.course_name }}è€ƒå‹¤è®°å½•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .stats-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .stat-item { display: inline-block; margin-right: 25px; }
        .present { color: #28a745; }
        .absent { color: #dc3545; }
        .approved_leave { color: #17a2b8; }
        .approved { color: #28a745; }
        .pending { color: #ffc107; }
        .rejected { color: #dc3545; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        th, td {
            border: 1px solid #dee2e6;
            padding: 12px;
            text-align: left;
        }
        th { background-color: #f8f9fa; }
        tr:nth-child(even) { background-color: #f8f9fa; }
        .action-btns a {
            padding: 5px 10px;
            border-radius: 4px;
            text-decoration: none;
            font-size: 14px;
        }
        .approve-btn { background: #28a745; color: white; }
        .reject-btn { background: #dc3545; color: white; margin-left: 8px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>{{ course.course_name }} ({{ course.course_code }})</h1>
        <p>æˆè¯¾æ•™å¸ˆ: {{ course.teacher.name }}</p>

        <!-- è€ƒå‹¤ç»Ÿè®¡å¡ç‰‡ -->
        <div class="stats-card">
            <h3>ğŸ“Š è€ƒå‹¤ç»Ÿè®¡</h3>
            <div class="stat-item">æ€»è®°å½•: {{ attendance_stats.total }}</div>
            <div class="stat-item present">å‡ºå‹¤: {{ attendance_stats.present }}</div>
            <div class="stat-item absent">ç¼ºå‹¤: {{ attendance_stats.absent }}</div>
            <div class="stat-item approved_leave">æ‰¹å‡†è¯·å‡: {{ attendance_stats.approved_leave }}</div>
        </div>

        <!-- è¯·å‡ç»Ÿè®¡å¡ç‰‡ -->
        <div class="stats-card">
            <h3>ğŸ“ è¯·å‡ç»Ÿè®¡</h3>
            <div class="stat-item">æ€»ç”³è¯·: {{ leave_stats.total }}</div>
            <div class="stat-item approved">å·²æ‰¹å‡†: {{ leave_stats.approved }}</div>
            <div class="stat-item pending">å¾…å®¡æ‰¹: {{ leave_stats.pending }}</div>
            <div class="stat-item rejected">å·²æ‹’ç»: {{ leave_stats.rejected }}</div>
        </div>

        <!-- è€ƒå‹¤è®°å½•è¡¨æ ¼ -->
        <h2>ğŸ“… è€ƒå‹¤è®°å½•</h2>
        <table>
            <thead>
                <tr>
                    <th>æ—¥æœŸ</th>
                    <th>å­¦å·</th>
                    <th>å§“å</th>
                    <th>çŠ¶æ€</th>
                    <th>ç­¾åˆ°æ—¶é—´</th>
                </tr>
            </thead>
            <tbody>
                {% for record in attendance_records %}
                <tr>
                    <td>{{ record.date|date:"Y-m-d" }}</td>
                    <td>{{ record.student.student_id }}</td>
                    <td>{{ record.student.name }}</td>
                    <td class="{{ record.status }}">
                        {% if record.status == 'present' %}å‡ºå‹¤
                        {% elif record.status == 'absent' %}ç¼ºå‹¤
                        {% elif record.status == 'approved_leave' %}æ‰¹å‡†è¯·å‡
                        {% endif %}
                    </td>
                    <td>
                        {% if record.scan_time %}
                            {{ record.scan_time|time:"H:i" }}
                        {% else %}-
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- è¯·å‡è®°å½•è¡¨æ ¼ -->
        <h2>ğŸ“‹ è¯·å‡è®°å½•</h2>
        <table>
            <thead>
                <tr>
                    <th>è¯·å‡æ—¥æœŸ</th>
                    <th>å­¦å·</th>
                    <th>å§“å</th>
                    <th>åŸå› </th>
                    <th>çŠ¶æ€</th>
                    <th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody>
                {% for leave in leave_records %}
                <tr>
                    <td>{{ leave.leave_date|date:"Y-m-d" }}</td>
                    <td>{{ leave.student.student_id }}</td>
                    <td>{{ leave.student.name }}</td>
                    <td>{{ leave.reason|truncatechars:30 }}</td>
                    <td class="{{ leave.leave_status }}">
                        {% if leave.leave_status == 'approved' %}å·²æ‰¹å‡†
                        {% elif leave.leave_status == 'rejected' %}å·²æ‹’ç»
                        {% else %}å¾…å®¡æ‰¹
                        {% endif %}
                    </td>
                    <td class="action-btns">
                        {% if leave.status == 'pending' %}
                        <a href="{% url 'approve_leave' leave.id %}" class="approve-btn">æ‰¹å‡†</a>
                        <a href="{% url 'reject_leave' leave.id %}" class="reject-btn">æ‹’ç»</a>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <div style="margin-top: 30px;">
            <a href="{% url 'teacher_check_records' %}" style="padding: 8px 15px; background: #6c757d; color: white; text-decoration: none; border-radius: 4px;">
                â† è¿”å›æŸ¥è¯¢
            </a>
        </div>
    </div>
</body>
</html>