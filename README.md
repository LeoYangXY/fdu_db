# 微信数据库项目设置与操作指南

本指南详细介绍了基于 Django 框架构建的微信数据库项目的设置流程、数据导入步骤以及操作流程。请确保您的电脑和移动设备连接到同一个 Wi-Fi 网络，以确保操作顺畅。

## 开发环境配置

### 操作系统
- Windows 11 

### 编程语言
- Python 3.9 

### 核心框架
- Django 4.2.21 

### 数据库
- MySQL 8.0.41 


## 环境配置

### 使用 Conda 配置环境

仓库中的 `env.yaml` 文件已经包含了创建环境所需的所有依赖项配置。请按以下步骤操作：

1. **创建 Conda 环境**  
   在终端中运行以下命令（确保当前目录包含 `env.yaml` 文件）：
   ```bash
   conda env create -f env.yaml


## 数据库设置

1. **登录主机 MySQL** 并创建名为 `wechat_db` 的数据库：
   ```sql
   CREATE DATABASE wechat_db;
   ```

2. **配置 Django 设置**：
   - 解压项目压缩包，进入 `wechat_db` 文件夹下的 `settings.py` 文件。
   - 找到 `DATABASES` 配置部分：
     ```python
     DATABASES = {
         'default': {
             'ENGINE': 'django.db.backends.mysql',    # 数据库引擎
             'NAME': 'wechat_db',                     # 数据库名称
             'HOST': '127.0.0.1',                     # 数据库地址（本地 IP 地址）
             'PORT': 3306,                            # 端口
             'USER': 'root',                          # 数据库用户名
             'PASSWORD': '********',                  # 数据库密码
         }
     }
     ```
   - 将 `'PASSWORD': '********'` 替换为您本地的 MySQL 密码，然后保存文件。

3. **运行数据库迁移**：
   - 打开终端并执行以下命令：
      ```bash
     python manage.py makemigrations
     ```
     ```bash
     python manage.py migrate
     ```

4. **启动服务器**：
   - 在终端中运行以下命令以启动初始化界面：(其中runserver_with_ip为我们自主实现的函数，能够获取自动当前的ip地址，然后显示在终端)
     ```bash
     python manage.py runserver_with_ip
     ```
   - 终端将生成一个相关网址（例如 `http://192.168.1.4:8000/`），点击进入。

5. **创建管理员**：
   - 另开一个终端，运行以下命令以创建管理员账户：
     ```bash
     python create_admin.py
     ```
   - 此时管理员账户已创建完成。

## 数据导入

1. **登录管理员界面**：
   - 在网页界面选择“管理员”身份，账号和密码均为 `admin001`。
   - 导航至“数据导入”功能。

2. **导入 Excel 数据**：
   - data这个压缩包中提供了四个 Excel 文件，分别对应数据库信息：
     - `course_template`：课程信息
     - `student_template`：学生信息
     - `teacher_template`：教师信息
     - `enrollment_template`：选课信息
   - 在数据导入页面，选择对应的数据类型并上传相应的 Excel 文件。
   - 注意：由于程序内部的唯一性约束，需先导入学生和教师信息，再导入课程和选课信息。
   - 导入成功后，页面将显示“成功导入数据”的提示。

3. **管理员操作结束**：
   - 至此，管理员的业务流程完成。

## 学生与教师操作流程

### 请假功能

1. **学生申请请假**：
   - **学生 S10008**（用于老师批准请假）：
     - 身份类型选择“学生”，学号输入 `S10008`，密码输入 `111111`（为便于操作，所有学生和教师密码均设为 `111111`，实际使用中可修改）。
     - 登录后选择“申请请假”。
     - 输入课程代码 `CS001`（注意：S10008 为计算机系学生，输入 `MA002` 将报错）。
     - 填写请假原因并提交。
     - 页面下滑可看到“待审核”的请假申请记录。
   - **学生 S10015**（用于老师不批准请假）：
     - 身份类型选择“学生”，学号输入 `S10015`，密码输入 `111111`。
     - 同样申请课程 `CS001` 的请假，填写原因并提交。

2. **教师审批请假**：
   - 重新访问 `http://192.168.1.4:8000/`，选择“教师”身份，工号输入 `T1000`，密码输入 `111111`。
   - 登录后选择“批量请假审批”业务。
   - 输入课程代码 `CS001`（注意：输入 `MA002` 将报错，因为该教师无权查看此课程）。
   - 查询请假记录后，选择：
     - 对 S10008 的请假记录选择“批准”。
     - 对 S10015 的请假记录选择“拒绝”。
   - 确认提交审批。

3. **学生查看审批结果**：
   - **学生 S10008**：
     - 重新登录，学号 `S10008`，密码 `111111`。
     - 点击“申请请假”，页面下滑，待审核记录变为“已批准”。
     - 在学生仪表盘界面，因请假通过，会显示“请假过多预警”（为展示方便，阈值设为 1 次，实际可设为 3 次或更多）。
     - “缺勤次数过多预警”无记录。
     - 在学生仪表盘界面点击查看选定课程考勤及请假，输入`CS001`（注意：输入 `MA002` 这一不是自己选修的将显示无任何数据）
   - **学生 S10015**：
     - 重新登录，学号 `S10015`，密码 `111111`。
     - 点击“申请请假”，页面下滑，待审核记录变为“已拒绝”。
     - 在学生仪表盘界面，“请假过多预警”无提示，但“缺勤次数过多预警”有记录。
     - 在学生仪表盘界面点击查看选定课程考勤及请假，输入`CS001`（注意：输入 `MA002` 这一不是自己选修的将显示无任何数据）


### 扫码签到流程

1. **教师生成二维码**：
   - 在教师网页界面，选择“生成课程二维码”。
   - 输入课程代码 `CS001`（注意：输入 `MA002` 将报错，因为教师无权生成此课程二维码）。
   - 页面将显示二维码，每两分钟刷新一次。

2. **学生扫码签到**：
   - 使用手机微信（确保手机与电脑连接同一 Wi-Fi），扫描教师生成的二维码。
   - 进入学生登录界面，选择“学生”，输入学号 `S10003`，密码 `111111`。
   - 点击“签到”确认后退出。

3. **教师查看考勤记录**：
   - 返回教师网页，选择“查看考勤记录”。
   - 输入课程代码 `CS001`（注意：输入 `MA002` 将报错）。
   - 查看课程的考勤记录和请假记录。
   - 右上角提供“导出 Excel”的选项，方便教师进行数据分析。


## 分工说明

### 前后端分工：
- 阎丞麟：负责后端部分代码书写  
- 潘艺赫：负责前端部分代码书写  
- 杜景琦：负责前端部分代码书写  
- 杨烜一：负责后端部分代码书写  

### 系统测试：
由4位成员共同完成


